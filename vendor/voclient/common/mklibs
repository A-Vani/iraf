#!/bin/sh

top=`(cd .. ; pwd)`
#top=`pwd`

export CC="gcc"
export CXX="g++"

export PLATFORM=`uname -s`
export PLMACH=`uname -m`


if [ "$PLATFORM" = "Darwin" ] ; then
    if [ "$IRAFARCH" = "macintel" ] ; then
	export CFLAGS='-m64 -mmacosx-version-min=10.4'
	export LDFLAGS='-m64 -mmacosx-version-min=10.4'
	export LADD='-m64 -mmacosx-version-min=10.4'
    else
	export CFLAGS='-arch i386 -m32 -mmacosx-version-min=10.4'
	export LDFLAGS='-arch i386 -m32 -mmacosx-version-min=10.4'
        export LADD='-arch i386 -m32 -mmacosx-version-min=10.4'
    fi
else
    export CFLAGS="-O2"
fi

build_cfitsio=0



echo "Building support libraries ...."
echo "  (Using toplevel directory '"$top/"' ....)"

# Global options.
gopts="--prefix=$top/ --exec-prefix=$top/ --disable-shared"

#echo "    Cleaning files ...."
#./mkclean

if [ $build_cfitsio = 1 ] ; then
    echo "    Building CFITSIO libs ...."
    (cd cfitsio ; ./mklibs)

else
    if [ ! -e lib/libcfitsio.a -a -e ../../bin/libcfitsio.a ] ; then
	ln -s ../../bin/libcfitsio.a lib/libcfitsio.a
    fi
fi
