#!/bin/csh -f

#set top = `(chdir .. ; pwd)`
set p = `pwd`
set top = $p:h

setenv CC 	"gcc"
setenv CXX 	"g++"

setenv PLATFORM `uname -s`
setenv PLMACH   `uname -m`


if ($PLATFORM == "Darwin") then
   if ( $?IRAFARCH ) then
       if ( "$IRAFARCH" == "macintel" ) then
           setenv CFLAGS   '-m64 -mmacosx-version-min=10.4'
           setenv LDFLAGS  '-m64 -mmacosx-version-min=10.4'
           setenv LADD     '-m64 -mmacosx-version-min=10.4'
       else
           setenv CFLAGS   '-arch i386 -m32 -mmacosx-version-min=10.4'
           setenv LDFLAGS  '-arch i386 -m32 -mmacosx-version-min=10.4'
           setenv LADD     '-arch i386 -m32 -mmacosx-version-min=10.4'
       endif
   endif
else
   setenv CFLAGS   "-O2"
endif


set	build_cfitsio	= 0


echo "Building support libraries ...."
echo "  (Using toplevel directory '"$top/"' ....)"

# Global options.
set	gopts = "--prefix=$top/ --exec-prefix=$top/ --disable-shared"

#echo "    Cleaning files ...."
#./mkclean

if ($build_cfitsio == 1) then
    echo "    Building CFITSIO libs ...."
    (cd cfitsio ; ./mklibs)

else
  if ( (! (-e lib/libcfitsio.a)) && (-e ../../bin/libcfitsio.a)) then
      ln -s ../../bin/libcfitsio.a lib/libcfitsio.a
  endif
endif
